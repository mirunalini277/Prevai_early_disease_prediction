<!DOCTYPE html>
<html lang="en">
<head>
  <title>PrevAI – Health Ministry Dashboard</title>
  <meta charset="UTF-8">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
  <div class="container-fluid px-4">
    <span class="navbar-brand fw-bold">PrevAI – Health Ministry</span>

    <ul class="navbar-nav ms-auto">
      <li class="nav-item">
        <button class="nav-link btn btn-link" onclick="showSection('dashboard')">Surveillance</button>
      </li>
      <li class="nav-item">
        <button class="nav-link btn btn-link" onclick="showSection('register')">Hospital Registry</button>
      </li>
      <li class="nav-item">
        <button class="nav-link btn btn-link" onclick="showSection('press')">Press Release</button>
      </li>
      <li class="nav-item">
        <button class="nav-link btn btn-link text-danger" onclick="logout()">Logout</button>
      </li>
    </ul>
  </div>
</nav>

<div class="container mt-4">

<!-- ================= DASHBOARD SECTION ================= -->
<div id="dashboardSection">
<div class="mb-4 p-3 bg-white border rounded position-relative">
  <span class="position-absolute top-0 start-0 h-100"
        style="width:6px; background:#198754; border-radius:6px 0 0 6px;"></span>

  <h5 class="mb-1 text-success">Disease Surveillance Dashboard</h5>
  <p class="text-muted mb-0">
    Monitor reported cases and AI-based outbreak predictions
  </p>
</div>

  <!-- District Selector -->
  <label class="fw-semibold mb-1">Select District</label>
  <select id="districtSelect" class="form-select w-25 mb-3" onchange="loadDistrictData()">
    <option value="">Select District</option>
    <option value="Chennai">Chennai</option>
    <option value="Coimbatore">Coimbatore</option>
    <option value="Madurai">Madurai</option>
  </select>


  <!-- Table -->
  <table class="table table-bordered bg-white">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Disease</th>
        <th>Reported</th>
        <th>Predicted</th>
        <th>Risk</th>
        <th>Trend</th>
      </tr>
    </thead>
    <tbody id="diseaseTable">
      <!-- Filled by JS -->
    </tbody>
  </table>

  <!-- Chart -->
  <div id="chartSection" class="border rounded p-4 mt-4 bg-white" style="display:none;">
    <h5 id="chartTitle"></h5>
    <p class="text-muted">Reported vs Predicted (7-day forecast)</p>
    <canvas id="trendChart"></canvas>
  </div>

</div>

<!-- ================= REGISTER SECTION ================= -->
<div id="registerSection" style="display:none;">
  <h4>Register Hospital</h4>

  <form id="registerHospitalForm">

    <input
      id="hospitalEmail"
      class="form-control mt-2"
      placeholder="Hospital Email"
      required
    >

    <input
      id="hospitalPassword"
      class="form-control mt-2"
      placeholder="Password"
      required
    >

    <select id="hospitalRegion" class="form-select mt-2" required>
      <option value="">Select District</option>
      <option value="Chennai">Chennai</option>
      <option value="Coimbatore">Coimbatore</option>
    </select>

    <button type="submit" class="btn btn-success mt-3">
      Register Hospital
    </button>

  </form>
</div>

<!-- ================= PRESS SECTION ================= -->
<div id="pressSection" style="display:none;">
  <h4>Publish Press Release</h4>

  <input
    id="pressTitle"
    class="form-control mt-2"
    placeholder="Title"
  >

  <textarea
    id="pressContent"
    class="form-control mt-2"
    rows="4"
    placeholder="Public advisory"
  ></textarea>

  <button
    class="btn btn-danger mt-3"
    onclick="publishPress()"
  >
    Publish
  </button>
</div>

</div>

<!-- ================= JAVASCRIPT ================= -->
<script>
let chartInstance = null;

function showSection(section) {
  document.getElementById("dashboardSection").style.display = "none";
  document.getElementById("registerSection").style.display = "none";
  document.getElementById("pressSection").style.display = "none";

  if (section === "dashboard") {
    document.getElementById("dashboardSection").style.display = "block";
  } else if (section === "register") {
    document.getElementById("registerSection").style.display = "block";
  } else if (section === "press") {
    document.getElementById("pressSection").style.display = "block";
  }
}

function logout() {
  window.location.href = "login.html";
}

/* ===== Dummy Dashboard Data ===== */
function loadDistrictData() {
  const table = document.getElementById("diseaseTable");
  table.innerHTML = "";

  const dummy = [
    {date:"2024-03-01", disease:"Dengue", reported:120, predicted:80, risk:"High"},
    {date:"2024-03-08", disease:"Dengue", reported:150, predicted:100, risk:"High"}
  ];

  dummy.forEach(row => {
    table.innerHTML += `
      <tr onclick="showChart('${row.disease}')">
        <td>${row.date}</td>
        <td>${row.disease}</td>
        <td>${row.reported}</td>
        <td>${row.predicted}</td>
        <td class="text-danger">${row.risk}</td>
        <td><button class="btn btn-sm btn-outline-primary">View</button></td>
      </tr>
    `;
  });
}

/* ===== Chart ===== */
function showChart(disease) {
  document.getElementById("chartSection").style.display = "block";
  document.getElementById("chartTitle").innerText = disease + " Trend";

  const ctx = document.getElementById("trendChart");

  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(ctx, {
    type: "line",
    data: {
      labels: ["Day 1","Day 2","Day 3","Day 4","Day 5","Day 6","Day 7"],
      datasets: [
        {
          label: "Reported Cases",
          data: [20, 40, 55, 70, 90, 110, 150],
          borderColor: "red",
          fill: false
        },
        {
          label: "Predicted Cases",
          data: [30, 50, 60, 75, 85, 100, 120],
          borderColor: "blue",
          fill: false
        }
      ]
    }
  });
}

/* ===== Register Hospital ===== */
document.getElementById("registerHospitalForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("hospitalEmail").value;
  const password = document.getElementById("hospitalPassword").value;
  const region = document.getElementById("hospitalRegion").value;

  const response = await fetch("http://127.0.0.1:8000/ministry/register-hospital", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({email, password, region})
  });

  const data = await response.json();
  alert(data.message);
});
</script>
<script>
async function publishPress() {
  const title = document.getElementById("pressTitle").value;
  const content = document.getElementById("pressContent").value;

  if (!title || !content) {
    alert("Please fill all fields");
    return;
  }

  try {
    const res = await fetch("http://127.0.0.1:8000/press", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, content })
    });

    const data = await res.json();
    alert(data.message);

    document.getElementById("pressTitle").value = "";
    document.getElementById("pressContent").value = "";

  } catch (err) {
    alert("Error publishing press");
    console.error(err);
  }
}
</script>

</body>
</html>
