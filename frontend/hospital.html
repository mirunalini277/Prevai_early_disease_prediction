<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PrevAI – Hospital Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Same CSS theme as index -->
  <link rel="stylesheet" href="css/home.css">
</head>

<body>

<!-- NAVBAR (UPDATED) -->
<nav class="navbar navbar-expand-lg bg-white border-bottom">
  <div class="container-fluid px-4">
    <a class="navbar-brand fw-bold text-dark" href="index.html">
      PrevAI – Disease Outbreak Early Warning
    </a>

    <a href="login.html" class="btn btn-outline-danger ms-auto">
      Logout
    </a>
  </div>
</nav>

<!-- MAIN CONTAINER -->
<div class="container my-5">

  <!-- PAGE TITLE -->
  <div class="mb-4">
    <h2 class="fw-semibold">Hospital Dashboard</h2>
    <p class="text-muted">
      Upload weekly disease case data to support early outbreak detection.
    </p>
  </div>

  <!-- WEEKLY UPLOAD REMINDER -->
  <div id="uploadWarning" class="alert alert-warning">
    Weekly data upload is recommended. Last submission was 8 days ago.
  </div>

  <!-- DASHBOARD BOXES -->
  <div class="row g-4">

    <!-- BOX 1: Instructions -->
    <div class="col-md-4">
      <div class="dashboard-box">
        <h5>Data Requirements</h5>
        <p class="small text-muted">
          Please upload hospital case data in CSV format with the following fields:
        </p>
        <p class="fw-semibold">
          Date | Region | Diagnosed_Disease | Reported_Cases
        </p>
      </div>
    </div>

    <!-- BOX 2: Upload -->
    <div class="col-md-4">
      <div class="dashboard-box">
        <h5>Weekly CSV Upload</h5>

        <form id="csvUploadForm">
          <input
            type="file"
            id="csvFile"
            class="form-control my-3"
            accept=".csv"
            required
          >

          <button type="submit" class="btn btn-success w-100">
            Upload CSV
          </button>
        </form>
      </div>
    </div>

    <!-- BOX 3: Status -->
    <div class="col-md-4">
      <div class="dashboard-box">
        <h5>Upload Status</h5>
        <div
          id="uploadStatus"
          class="status-box"
          aria-live="polite"
        >
          Awaiting upload...
        </div>
      </div>
    </div>

  </div>

  <!-- BOTTOM FULL-WIDTH BOX -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="dashboard-box">
        <h5>Important Notes</h5>
        <ul class="text-muted small">
          <li>Upload data once per week.</li>
          <li>Ensure all case counts are verified.</li>
          <li>Incorrect data may affect outbreak predictions.</li>
          <li>Uploaded data is securely processed by health authorities.</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<!-- SCRIPT -->
<script>
document.getElementById("csvUploadForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const fileInput = document.getElementById("csvFile");
  const statusBox = document.getElementById("uploadStatus");

  if (!fileInput.files.length) {
    statusBox.innerText = "Please select a CSV file.";
    return;
  }

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  statusBox.innerText = "Uploading CSV…";

  try {
    const response = await fetch("http://127.0.0.1:8000/hospital/upload-csv", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (data.status === "success") {
      statusBox.innerText =
        `Upload successful. ${data.rows_inserted} aggregated rows stored.`;
    } else {
      statusBox.innerText = "Upload failed: " + data.message;
    }

  } catch (err) {
    statusBox.innerText = "Backend not reachable. Is FastAPI running?";
  }
});
</script>


</body>
</html>
